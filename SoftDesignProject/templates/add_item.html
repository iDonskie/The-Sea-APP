{% extends "base.html" %}
{% block content %}
<style>
  .form-container{
    max-width:700px;
    margin:18px auto;
    padding:18px;
    border:1px solid #e0e0e0;
    border-radius:8px;
    background:#ffffff;
    box-shadow:0 6px 18px rgba(0,0,0,0.03);
    font-family:Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  .form-container h1{margin:0 0 14px 0;font-size:1.6rem;color:#111;}
  .item-form .form-row{display:flex;align-items:flex-start;margin-bottom:12px;gap:12px;}
  .item-form label{
    width:140px;
    min-width:120px;
    color:#2b2b2b;
    font-size:0.95rem;
    padding-top:6px;
  }
  .item-form input[type="text"],
  .item-form input[type="number"],
  .item-form input[type="file"],
  .item-form textarea,
  .item-form select,
  .item-form input{
    flex:1;
    padding:8px 10px;
    font-size:0.95rem;
    border:1px solid #cfcfcf;
    border-radius:6px;
    box-sizing:border-box;
  }
  .item-form textarea{min-height:100px;resize:vertical;}
  .item-form .small{font-size:0.85rem;color:#666;margin-top:4px}
  .form-actions{display:flex;justify-content:flex-end;margin-top:16px;}
  .btn{
    background:#007bff;color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;font-weight:600;
  }
  .btn:hover{background:#0064e6}
  
  .image-upload-container{flex:1;}
  .image-preview-container{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:8px;
  }
  .image-preview-item{
    position:relative;
    width:80px;
    height:80px;
    border:1px solid #ddd;
    border-radius:4px;
    overflow:hidden;
  }
  .image-preview-item img{
    width:100%;
    height:100%;
    object-fit:cover;
  }
  .image-preview-item .remove-btn{
    position:absolute;
    top:2px;
    right:2px;
    background:rgba(255,0,0,0.8);
    color:white;
    border:none;
    border-radius:50%;
    width:18px;
    height:18px;
    font-size:12px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .image-preview-item .primary-badge{
    position:absolute;
    bottom:2px;
    left:2px;
    background:rgba(0,123,255,0.8);
    color:white;
    font-size:10px;
    padding:1px 4px;
    border-radius:2px;
  }
  
  @media (max-width:560px){
    .item-form .form-row{flex-direction:column;}
    .item-form label{width:100%;min-width:0;padding-top:0;}
    .form-actions{justify-content:center;}
  }
</style>

<div class="form-container">
  <h1>Add Item</h1>
  <form method="post" enctype="multipart/form-data" class="item-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="form-row">
      <label for="item_name">Item name</label>
      <input id="item_name" name="item_name" required>
    </div>

    <div class="form-row">
      <label for="price">Price</label>
      <input id="price" name="price" placeholder="e.g. 200.00">
    </div>

    <div class="form-row">
      <label for="description">Description</label>
      <textarea id="description" name="description" placeholder="Add details about the item"></textarea>
    </div>

    <div class="form-row">
      <label for="category">Category</label>
      <select id="category" name="category" required>
        <option value="books">Books</option>
        <option value="electronics">Electronics</option>
        <option value="supplies">Supplies</option>
        <option value="appliances">Appliances</option>
        <option value="clothing">Clothing</option>
        <option value="food">Food</option>
        <option value="gaming">Gaming</option>
        <option value="other" selected>Other</option>
      </select>
    </div>

    <div class="form-row">
      <label for="images">Images</label>
      <div class="image-upload-container">
        <input id="images" type="file" name="images" accept="image/*" multiple>
        <div class="image-preview-container" id="imagePreviewContainer"></div>
        <div class="small">You can select multiple images (up to 5). The first image will be the main photo.</div>
      </div>
    </div>

    <div class="form-row">
      <label for="contact">Contact</label>
      <input id="contact" name="contact" placeholder="phone or email">
    </div>

    <div class="form-row">
      <label for="payment">Payment</label>
      <input id="payment" name="payment" placeholder="e.g. Cash / GCash / Bank Transfer">
    </div>

    <div class="form-actions">
      <button class="btn" type="submit">Add item</button>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.getElementById('images');
    const previewContainer = document.getElementById('imagePreviewContainer');
    let selectedFiles = [];

    imageInput.addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        
        // Limit to 5 images
        if (selectedFiles.length + files.length > 5) {
            alert('You can only upload up to 5 images');
            return;
        }

        files.forEach((file, index) => {
            if (file.type.startsWith('image/')) {
                selectedFiles.push(file);
                createPreviewItem(file, selectedFiles.length - 1);
            }
        });

        updateFileInput();
    });

    function createPreviewItem(file, index) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewItem = document.createElement('div');
            previewItem.className = 'image-preview-item';
            previewItem.innerHTML = `
                <img src="${e.target.result}" alt="Preview">
                <button type="button" class="remove-btn" onclick="removeImage(${index})">&times;</button>
                ${index === 0 ? '<span class="primary-badge">Main</span>' : ''}
            `;
            previewContainer.appendChild(previewItem);
        };
        reader.readAsDataURL(file);
    }

    window.removeImage = function(index) {
        selectedFiles.splice(index, 1);
        updatePreview();
        updateFileInput();
    };

    function updatePreview() {
        previewContainer.innerHTML = '';
        selectedFiles.forEach((file, index) => {
            createPreviewItem(file, index);
        });
    }

    function updateFileInput() {
        // Create a new DataTransfer to update the file input
        const dt = new DataTransfer();
        selectedFiles.forEach(file => {
            dt.items.add(file);
        });
        imageInput.files = dt.files;
    }
});
</script>
{% endblock %}