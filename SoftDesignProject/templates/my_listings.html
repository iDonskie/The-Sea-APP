{% extends "base.html" %}
{% block content %}
<style>
  .my-listings{max-width:800px;margin:18px auto;padding:12px;font-family:Segoe UI,Roboto,Arial;}
  .my-listings h1{font-size:1.6rem;margin-bottom:8px;}
  .my-item{display:flex;gap:12px;align-items:flex-start;padding:12px;border:1px solid #eee;border-radius:6px;margin-bottom:12px;}
  .my-thumb{width:140px;flex-shrink:0;position:relative;height:105px;overflow:hidden;}
  .my-thumb img{width:100%;height:100%;object-fit:cover;border-radius:6px;border:1px solid #ddd;}
  .my-body{flex:1;}
  .my-title{font-weight:700;margin-bottom:6px;}
  .my-desc{margin:6px 0;color:#222;}
  .my-actions{margin-top:8px;display:flex;gap:8px;}
  .btn{background:#007bff;color:#fff;padding:8px 12px;border-radius:6px;text-decoration:none;}
  .btn-danger{background:#e03e2d;}
  
  .category-tag {
    display: inline-block;
    background: #e3f2fd;
    color: #1976d2;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid #bbdefb;
  }
  
  .category-books { background: #e8f5e8; color: #2e7d32; border-color: #c8e6c9; }
  .category-electronics { background: #fff3e0; color: #f57c00; border-color: #ffcc02; }
  .category-supplies { background: #f3e5f5; color: #7b1fa2; border-color: #e1bee7; }
  .category-appliances { background: #e0f2f1; color: #00695c; border-color: #b2dfdb; }
  .category-clothing { background: #fce4ec; color: #c2185b; border-color: #f8bbd9; }
  .category-other { background: #f5f5f5; color: #616161; border-color: #e0e0e0; }
  
  @media(max-width:600px){ .my-item{flex-direction:column;} .my-thumb{width:100%} }
</style>

<div class="my-listings">
  <h1>My Listings</h1>

  {% if items %}
    {% for item in items %}
      <div class="my-item">
        <div class="my-thumb">
          {% if item['images'] and item['images']|length > 0 %}
            <img src="{{ url_for('static', filename='uploads/' ~ item['images'][0]['image_filename']) }}" alt="{{ item['item_name'] }}">
            {% if item['images']|length > 1 %}
              <div style="position:absolute; top:5px; right:5px; background:rgba(0,0,0,0.7); color:white; padding:2px 6px; border-radius:10px; font-size:12px;">
                +{{ item['images']|length - 1 }}
              </div>
            {% endif %}
          {% elif item['primary_image'] %}
            <img src="{{ url_for('static', filename='uploads/' ~ item['primary_image']) }}" alt="{{ item['item_name'] }}">
          {% else %}
            <img src="{{ url_for('static', filename='placeholder.png') }}" alt="No image">
          {% endif %}
        </div>

        <div class="my-body">
          <div style="margin-bottom: 6px;">
            <span class="category-tag category-{{ item.get('category', 'other') }}">{{ (item.get('category', 'other')|title) }}</span>
          </div>
          <div class="my-title">{{ item['item_name'] }} â€” {{ item['price']|php }}</div>
          <div class="my-meta"><em>Status: {{ item['status'] or 'available' }}</em></div>

          {% if item['description'] %}
            <div class="my-desc">{{ item['description'] }}</div>
          {% endif %}

          <div>Contact: {{ item['contact'] }}</div>
          <div>Payment: {{ item['payment'] }}</div>

          <div class="my-actions">
            <a class="btn" href="{{ url_for('edit_listing', item_id=item['item_id']) }}">Edit</a>
            <form action="{{ url_for('delete_listing', item_id=item['item_id']) }}" method="post" style="display:inline">
              <button class="btn btn-danger" type="submit" onclick="return confirm('Remove this listing?');">Delete</button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>No listings.</p>
  {% endif %}
</div>
{% endblock %}